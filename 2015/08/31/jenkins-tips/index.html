<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Jenkins tips | Andrew&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在windows上以service的方式安装jenkins slave节点

在命令行运行，安装slave节点

1java -jar slave.jar -jnlpUrl http://jenkins-server-ip:8080/jenkins/computer/&amp;#123;&amp;#123;node name&amp;#125;&amp;#125;/slave-agent.jnlp -secret 2d0">
<meta property="og:type" content="article">
<meta property="og:title" content="Jenkins tips">
<meta property="og:url" content="http://liuhongjiang.github.io/2015/08/31/jenkins-tips/index.html">
<meta property="og:site_name" content="Andrew's Blog">
<meta property="og:description" content="在windows上以service的方式安装jenkins slave节点

在命令行运行，安装slave节点

1java -jar slave.jar -jnlpUrl http://jenkins-server-ip:8080/jenkins/computer/&amp;#123;&amp;#123;node name&amp;#125;&amp;#125;/slave-agent.jnlp -secret 2d0">
<meta property="og:image" content="http://liuhongjiang.github.io/hexotech/images/blogimages/2015/jenkins-github-oauth.png">
<meta property="og:image" content="http://liuhongjiang.github.io/hexotech/images/blogimages/2015/github-applications.png">
<meta property="og:updated_time" content="2015-12-23T07:30:42.377Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jenkins tips">
<meta name="twitter:description" content="在windows上以service的方式安装jenkins slave节点

在命令行运行，安装slave节点

1java -jar slave.jar -jnlpUrl http://jenkins-server-ip:8080/jenkins/computer/&amp;#123;&amp;#123;node name&amp;#125;&amp;#125;/slave-agent.jnlp -secret 2d0">
  
    <link rel="alternative" href="/atom.xml" title="Andrew&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/hexotech/images/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/hexotech/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/hexotech/" id="logo">Andrew&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/hexotech/">Home</a>
        
          <a class="main-nav-link" href="/hexotech/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://liuhongjiang.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-jenkins-tips" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/hexotech/2015/08/31/jenkins-tips/" class="article-date">
  <time datetime="2015-08-31T09:10:30.000Z" itemprop="datePublished">2015-08-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/hexotech/categories/jenkins/">jenkins</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Jenkins tips
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="在windows上以service的方式安装jenkins-slave节点">在windows上以service的方式安装jenkins slave节点</h2>
<ol style="list-style-type: decimal">
<li>在命令行运行，安装slave节点</li>
</ol>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">java -jar slave.jar -jnlpUrl http://jenkins-server-ip:8080/jenkins/computer/</span><span class="expression">&#123;&#123;<span class="variable">node</span> <span class="variable">name</span>&#125;&#125;</span><span class="xml">/slave-agent.jnlp -secret 2d00ae81d59ff37df0fe9c33a5ed671afa2bc495715c0c161091a8e429973eb1</span></span><br></pre></td></tr></table></figure>
<ol start="2" style="list-style-type: decimal">
<li><p>解决阻止自签名的问题 您的安全设置已阻止自签名的应用程序使用已过期的Java版本运行问题的解决 <figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">步骤：选择windows的开始<span class="function">--&gt;</span>控制面板<span class="function">--&gt;</span>在搜索栏中输入 java-<span class="function">-&gt;</span>点击查询出来的Java图标<span class="function">--&gt;</span>安全<span class="function">--&gt;</span>把 高<span class="function"><span class="params">(推荐的最低设置)</span>--&gt;</span>改成 中<span class="function">--&gt;</span>确定<span class="function">--&gt;</span>即可。</span><br></pre></td></tr></table></figure></p></li>
<li><p>以servcie的方式启动 在下面的页面上： http://jenkins-server-ip:8080/jenkins/computer/{node name} <figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">操作步骤： 点击<span class="type">Launch</span>--&gt;保留--&gt;把slave-agent.jnlp拷贝到<span class="type">C</span>:\<span class="type">CI</span>\jenkins-slave下--&gt;使用javaws.exe(java web start launcher)--&gt;继续--&gt;</span><br><span class="line">点击 我接受风险并希望运行此应用程序。--&gt;运行--&gt;<span class="type">File</span>--&gt;<span class="type">Install</span> <span class="keyword">as</span> a service--&gt;确定--&gt;是--&gt;是</span><br></pre></td></tr></table></figure></p></li>
</ol>
<p>这样Jenkins节点以Windows Service的方式在运行了。</p>
<a id="more"></a>
<ol start="4" style="list-style-type: decimal">
<li>程序不能在Administrator的账号下面运行：</li>
</ol>
<p>某些程序无法再admininstrator上运行，但是jenkins slave是以administrator启动的，只有通过修改jenkins service的登录账号解决。</p>
<p>步骤: I too had a similar issue once. Try granting the Jenkins service “Logon as This account” right under services.msc and make sure the account you type there is the same as the one you use for running cmd.exe.</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在window运行中输入services<span class="built_in">.</span>msc-<span class="subst">-&gt;</span>选择Jenkins-<span class="subst">-&gt;</span><span class="keyword">Log</span> <span class="keyword">On</span>-<span class="subst">-&gt;</span>Logon as This account <span class="keyword">to</span> This account : andrew/andrewpassword -<span class="subst">-&gt;</span>OK</span><br></pre></td></tr></table></figure>
<p>重启Jenkins节点的服务,重新构建项目,就转换成了andrew用户来运行了.</p>
<p>参考： <a href="http://stackoverflow.com/questions/10952280/execute-windows-batch-command-from-jenkins-fails-but-runs-fine-in-cmd-exe" target="_blank" rel="external">Execute windows batch command from Jenkins fails but runs fine in cmd.exe</a></p>
<h2 id="multi-branch-branch-for-git">multi-branch branch for git</h2>
<p><a href="http://blog.travis-ci.com/announcing-pull-request-support/" target="_blank" rel="external">travis-ci</a></p>
<p><a href="https://github.com/mjdetullio/multi-branch-project-plugin" target="_blank" rel="external">jenkins multi-branch-build plugin</a></p>
<h2 id="jenkins检查github的pull-request">jenkins检查github的pull request</h2>
<p>下面插件可以实现当在github上提交了一个pull request，他可以自动完成一些工作，例如对pull request加评论，验证pull request，对pull reques跑test等等。 没有具体试验过，以后有机会，试用一下，然后加评论。</p>
<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/GitHub+pull+request+builder+plugin" target="_blank" rel="external">GitHub pull request builder plugin</a></p>
<h2 id="jenkins分支同步">jenkins分支同步</h2>
<p>我们的项目是在github上，一个比较大的问题就是同步经常出问题，一个同事使用了这两个插件解决了这个问题。</p>
<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/CloudBees+Folders+Plugin" target="_blank" rel="external">CloudBees Folders Plugin</a></p>
<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/CloudBees+GitHub+Branch+Source+Plugin" target="_blank" rel="external">CloudBees GitHub Branch Source Plugin</a></p>
<h2 id="jenkins配置使用github登录">jenkins配置使用github登录</h2>
<p>安装<a href="https://wiki.jenkins-ci.org/display/JENKINS/Github+OAuth+Plugin" target="_blank" rel="external">Github OAuth Plugin</a>， 然后在manage jenkins的Configure Global Security中，可以将Access Control配置使用Github Authentication Plugin。</p>
<p>配置图如下：</p>
<img src="/hexotech/images/blogimages/2015/jenkins-github-oauth.png" class="center">
<p>上图中的api配置路径，如果使用的是GitHub Enterprise，那么url的路径就要配置为<code>/api/v3</code>.</p>
<p>client id和client seceret是在github中生成的。</p>
<p>打开github，在edit profile的地方，选择applications -&gt; developer applications, 生成一个新的application。 很多都是自动生成的，比较重要的一个是authorization callback url，这个也需要天固定的格式：</p>
<p>例如<code>http://myserver.com:8080/securityRealm/finishLogin</code>，其中myserver.com和端口8080对应你的jenkins的域名和端口。</p>
<p>下图是一个例子</p>
<img src="/hexotech/images/blogimages/2015/github-applications.png" class="center">
<p>在上图中，还可以给你的application加一个图标，如5所示。</p>
<h2 id="jenkins-tool配置">jenkins tool配置</h2>
<p>在jenkins中，使用到很多工具，例如git，maven，jdk，node。可以在manage jenkins -&gt; configure system中配置。</p>
<p>在配置中，如果选择了install automatically，那么jenkins就会在salve node上自动安装这个工具。这样如果在jenkins中使用docker node等这种方式的话，有可能每次都会去安装。</p>
<p>或者如果你的node已经安装了，jenkins也会去安装一次。</p>
<p>所以可以不选择install automatically， 然后配置一个XXX_HOME或者工具的path，那么jenkins就会自动去找个工具，而不是去安装。但是如果配置了工具的路径，这个配置是对所有node有效的。</p>
<p>如果对没有node需要单独配置的话，可以去manage node页面，在node的configure页面中配置tool location，这样这个配置项就就只对这个node生效。</p>
<p>当然还有一个jenkins plugin可以使用: <a href="https://wiki.jenkins-ci.org/display/JENKINS/Custom+Tools+Plugin" target="_blank" rel="external">Custom Tools Plugin</a>，它甚至可以对单独的一个job配置工具路径。</p>
<h2 id="参考">参考</h2>
<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Use+Jenkins" target="_blank" rel="external">jenkins main page</a></p>
<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Ubuntu" target="_blank" rel="external">installation jenkins on ubuntu</a></p>
<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Standard+Security+Setup" target="_blank" rel="external">enable jenkins user</a></p>
<p><a href="https://wiki.jenkins-ci.org/display/JENKINS/Installing+Jenkins+on+Red+Hat+distributions" target="_blank" rel="external">install jenkins on centos</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-git-on-a-centos-6-4-vps" target="_blank" rel="external">install the last git on centos</a></p>
<h2 id="issues">issues</h2>
<p>issue 1:</p>
<p><a href="http://stackoverflow.com/questions/23104110/unknown-option-git-config-local-reported-by-jenkins" target="_blank" rel="external">unknown-option-git-config-local-reported-by-jenkins</a></p>
<p>issue 2:</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed <span class="built_in">to</span> connect <span class="built_in">to</span> repository : Command <span class="string">"git -c core.askpass=true ls-remote -h https://github.com/liuhongjiang/gittest.git HEAD"</span> returned status code <span class="number">128</span>:</span><br><span class="line"><span class="keyword">stdout</span>: </span><br><span class="line"><span class="keyword">stderr</span>: fatal: Unable <span class="built_in">to</span> find remote helper <span class="keyword">for</span> <span class="string">'https'</span></span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/8329485/git-clone-fatal-unable-to-find-remote-helper-for-https" target="_blank" rel="external">solution: git-clone-fatal-unable-to-find-remote-helper-for-https</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuhongjiang.github.io/hexotech/2015/08/31/jenkins-tips/" data-id="ciyv9ii1800150si4px49idww" class="article-share-link">Share</a>
      
        <a href="http://liuhongjiang.github.io/hexotech/2015/08/31/jenkins-tips/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/hexotech/2015/09/07/Authentication-Anomaly-Detection-A-Case-Study-On-A-Virtual-Private-Network/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Authentication Anomaly Detection: A Case Study On A Virtual Private Network
        
      </div>
    </a>
  
  
    <a href="/hexotech/2015/08/26/install-kafka/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Install kafka</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/3rd-nbsp-tools/">3rd&nbsp;tools</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Algorithm/">Algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/C-C/">C/C++</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Data-nbsp-structure/">Data&nbsp;structure</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Fuck-nbsp-GFW/">Fuck&nbsp;GFW</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Language/">Language</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Machine-nbsp-Learning/">Machine&nbsp;Learning</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Vi/">Vi</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/git/">git</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/hadoop/">hadoop</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/javascript/">javascript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/jenkins/">jenkins</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/keystone-openstack/">keystone, openstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/math/">math</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/octopress/">octopress</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/openssl/">openssl</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/openstack/">openstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/paper/">paper</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/sqlite/">sqlite</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/12/">December 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/05/">May 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/12/">December 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/11/">November 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/09/">September 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/08/">August 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/06/">June 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/05/">May 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/04/">April 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2014/05/">May 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/08/">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/02/">February 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/01/">January 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2012/12/">December 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2012/11/">November 2012</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/hexotech/2016/12/23/enable-https-and-tokenless-auth-for-keystone/">Enable https and tokenless auth for keystone</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/12/23/setup-your-own-ca/">Setup your own CA</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/10/11/atom-tips/">atom tips</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/10/11/vagrant-multiple-vms/">vagrant multiple vms</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/09/23/install-ceph-through-vagrant-on-centos7/">install ceph through vagrant on centos7</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Andrew Liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/hexotech/" class="mobile-nav-link">Home</a>
  
    <a href="/hexotech/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'andrewliu117';
  
  var disqus_url = 'http://liuhongjiang.github.io/hexotech/2015/08/31/jenkins-tips/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/hexotech/js/jquery-2.1.4.min.js" type="text/javascript"></script>

<!--<script type="text/x-mathjax-config">-->
<!--MathJax.Hub.Config({-->
  <!--tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}-->
<!--});-->
<!--</script>-->
<!--<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">-->
<!--</script>-->


  <link rel="stylesheet" href="/hexotech/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/hexotech/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/hexotech/js/script.js" type="text/javascript"></script>



  </div>
</body>
</html>