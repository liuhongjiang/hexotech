<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Install spark | Andrew&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="前面一片文章install hadoop介绍了hadoop的安装，这一片安装spark的文章，就是在hadoop已经安装好的基础上进行的。
准备
下载spark
hadoop的版本为2.7.1，下载的是spark-1.4.1-bin-hadoop2.6.tgz。
这里下载是已经编译好的，也可以下载源码，自己编译。">
<meta property="og:type" content="article">
<meta property="og:title" content="Install spark">
<meta property="og:url" content="http://liuhongjiang.github.io/2015/08/25/install-spark/index.html">
<meta property="og:site_name" content="Andrew's Blog">
<meta property="og:description" content="前面一片文章install hadoop介绍了hadoop的安装，这一片安装spark的文章，就是在hadoop已经安装好的基础上进行的。
准备
下载spark
hadoop的版本为2.7.1，下载的是spark-1.4.1-bin-hadoop2.6.tgz。
这里下载是已经编译好的，也可以下载源码，自己编译。">
<meta property="og:updated_time" content="2015-10-22T01:44:09.843Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Install spark">
<meta name="twitter:description" content="前面一片文章install hadoop介绍了hadoop的安装，这一片安装spark的文章，就是在hadoop已经安装好的基础上进行的。
准备
下载spark
hadoop的版本为2.7.1，下载的是spark-1.4.1-bin-hadoop2.6.tgz。
这里下载是已经编译好的，也可以下载源码，自己编译。">
  
    <link rel="alternative" href="/atom.xml" title="Andrew&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/hexotech/images/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/hexotech/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/hexotech/" id="logo">Andrew&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/hexotech/">Home</a>
        
          <a class="main-nav-link" href="/hexotech/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://liuhongjiang.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-install-spark" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/hexotech/2015/08/25/install-spark/" class="article-date">
  <time datetime="2015-08-25T02:55:55.000Z" itemprop="datePublished">2015-08-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/hexotech/categories/hadoop/">hadoop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Install spark
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前面一片文章<a href="/2015/08/24/install-hadoop/">install hadoop</a>介绍了hadoop的安装，这一片安装spark的文章，就是在hadoop已经安装好的基础上进行的。</p>
<h2 id="准备">准备</h2>
<p>下载<a href="http://spark.apache.org/downloads.html" target="_blank" rel="external">spark</a></p>
<p>hadoop的版本为2.7.1，下载的是spark-1.4.1-bin-hadoop2.6.tgz。</p>
<p>这里下载是已经编译好的，也可以下载源码，自己编译。</p>
<a id="more"></a>
<h2 id="配置spark">配置spark</h2>
<p>本章节的内容都是在master操作。</p>
<p>解压spark-1.4.1-bin-hadoop2.6.tgz，移至<code>/usr/</code>目录下 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv spark-<span class="number">1.4</span><span class="number">.1</span>-bin-hadoop2<span class="number">.6</span> /usr/spark-<span class="number">1.4</span><span class="number">.1</span></span><br></pre></td></tr></table></figure></p>
<ol style="list-style-type: decimal">
<li><p>配置spark-env.sh 在目录<code>${SPARK_HOME}/conf</code>中，将<code>spark-env.sh.template</code>拷贝为<code>spark-env.sh</code>，添加以下内容： <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=<span class="regexp">/usr/</span>lib<span class="regexp">/jvm/</span>java-<span class="number">1.8</span>.<span class="number">0</span>-openjdk</span><br><span class="line">export SPARK_DIST_CLASSPATH=$(<span class="regexp">/usr/</span>hadoop<span class="regexp">/bin/</span>hadoop <span class="keyword">classpath</span>)</span><br></pre></td></tr></table></figure></p></li>
<li><p>配置spark-defaults.conf 在目录<code>${SPARK_HOME}/conf</code>中，将<code>spark-defaults.conf.template</code>拷贝为<code>spark-defaults.conf</code>，修改以下内容： <figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># Example:</span></span><br><span class="line">spark.master                     spark:<span class="comment">//master.hadoop:7077</span></span><br><span class="line"><span class="preprocessor"># spark.eventLog.enabled           true</span></span><br><span class="line"><span class="preprocessor"># spark.eventLog.dir               hdfs://namenode:8021/directory</span></span><br><span class="line"><span class="preprocessor"># spark.serializer                 org.apache.spark.serializer.KryoSerializer</span></span><br><span class="line">spark.driver.memory              <span class="number">500</span>m</span><br><span class="line"><span class="preprocessor"># spark.executor.extraJavaOptions  -XX:+PrintGCDetails -Dkey=value -Dnumbers="one two three"</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>配置slaves文件 在目录<code>${SPARK_HOME}/conf</code>中，将<code>slaves.template</code>拷贝为<code>slaves</code>，修改以下内容： <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">slave1</span><span class="class">.hadoop</span></span><br><span class="line"><span class="tag">slave2</span><span class="class">.hadoop</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>修改/etc/profile <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># set spark path</span></span><br><span class="line"><span class="keyword">export</span> SPARK_HOME=/usr/spark-<span class="number">1.4</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">export</span> SPARK_MASTER_IP=master.hadoop</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h2 id="拷贝到slave节点">拷贝到slave节点</h2>
<p>在master上操作完成后，需要将spark-1.4.1的目录拷贝到所有的slave节点上。 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">scp</span> <span class="tag">-r</span> <span class="tag">spark-1</span><span class="class">.4</span><span class="class">.1</span> <span class="tag">slave2</span><span class="rule"><span class="attribute">.hadoop</span>:<span class="value">/usr/</span></span></span><br></pre></td></tr></table></figure></p>
<p>然后将<code>/etc/profile</code>拷贝到slave节点上。 或者在profile文件中添加配置 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># set spark path</span></span><br><span class="line"><span class="keyword">export</span> SPARK_HOME=/usr/spark-<span class="number">1.4</span><span class="number">.1</span></span><br><span class="line"><span class="keyword">export</span> SPARK_MASTER_IP=master.hadoop</span><br></pre></td></tr></table></figure></p>
<h2 id="启动spark">启动spark</h2>
<p>启动了hadoop以后，可以通过下面的命令启动spark <figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">$&#123;SPARK_HOME&#125;</span>/sbin/start-<span class="literal">all</span>.sh</span><br></pre></td></tr></table></figure></p>
<h2 id="验证安装情况">验证安装情况</h2>
<ol style="list-style-type: decimal">
<li><p>运行自带示例 $ bin/run-example org.apache.spark.examples.SparkPi</p></li>
<li><p>查看集群环境 http://master:8080/</p></li>
<li><p>进入spark-shell <figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">$&#123;SPARK_HOME&#125;</span>/bin/spark-<span class="keyword">shell</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>查看sparkContext等信息</p></li>
</ol>
<p>当spark运行的时候，每一个SparkContext都会启动一个web UI, 默认的端口为4040，通这个端口，可以查看一些关于这个应用非常有用的信息。 包括一下信息： * A list of scheduler stages and tasks * A summary of RDD sizes and memory usage * Environmental information. * Information about the running executors</p>
<p>所以第一个SparkContext，可以通过下面的网址产看job信息</p>
<p>http://master:4040/jobs/</p>
<p>当有多个sparkcontext在同一个host上运行的时候，他们将顺序绑定4040自后的端口，例如（4041,4042等等)</p>
<h2 id="查看sparkcontext的history信息">查看sparkcontext的history信息</h2>
<p>Note that this information is only available for the duration of the application by default. To view the web UI after the fact, set spark.eventLog.enabled to true before starting the application. This configures Spark to log Spark events that encode the information displayed in the UI to persisted storage.</p>
<p>When using the file-system provider class (see spark.history.provider below), the base logging directory must be supplied in the spark.history.fs.logDirectory configuration option,</p>
<p>in the <code>/spark/conf/spark-defaults.conf</code> add:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spark<span class="class">.eventLog</span><span class="class">.enabled</span>           true</span><br><span class="line">spark<span class="class">.eventLog</span><span class="class">.dir</span>               hdfs:<span class="comment">//hadoop:9000/spark/event_log</span></span><br><span class="line">spark<span class="class">.history</span><span class="class">.fs</span><span class="class">.logDirectory</span>      hdfs:<span class="comment">//hadoop:9000/spark/log_directory</span></span><br></pre></td></tr></table></figure>
<p>注意：spark.eventLog.dir要与spark.history.fs.logDirectory要是一致的。</p>
<p>then go to the <code>sbin</code> directory: <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./<span class="operator"><span class="keyword">start</span>-history-<span class="keyword">server</span>.sh</span></span><br></pre></td></tr></table></figure></p>
<p>then can open spark history on port 18080: http://spark-host:18080/</p>
<p>更多信息可以参考：<a href="http://spark.apache.org/docs/latest/monitoring.html" target="_blank" rel="external">spark Monitoring and Instrumentation</a></p>
<h2 id="reference">reference</h2>
<p><a href="">http://blog.csdn.net/jediael_lu/article/details/45310321</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuhongjiang.github.io/hexotech/2015/08/25/install-spark/" data-id="ciyv99xe7001b1ki49puoujai" class="article-share-link">Share</a>
      
        <a href="http://liuhongjiang.github.io/hexotech/2015/08/25/install-spark/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/hexotech/2015/08/26/install-zookeeper/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Install zookeeper
        
      </div>
    </a>
  
  
    <a href="/hexotech/2015/08/24/install-hadoop/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Install hadoop</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/3rd-nbsp-tools/">3rd&nbsp;tools</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Algorithm/">Algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/C-C/">C/C++</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Data-nbsp-structure/">Data&nbsp;structure</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Fuck-nbsp-GFW/">Fuck&nbsp;GFW</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Language/">Language</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Machine-nbsp-Learning/">Machine&nbsp;Learning</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Vi/">Vi</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/git/">git</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/hadoop/">hadoop</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/javascript/">javascript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/jenkins/">jenkins</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/keystone-openstack/">keystone, openstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/math/">math</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/octopress/">octopress</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/openssl/">openssl</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/openstack/">openstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/paper/">paper</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/sqlite/">sqlite</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/12/">December 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/05/">May 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/12/">December 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/11/">November 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/09/">September 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/08/">August 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/06/">June 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/05/">May 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/04/">April 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2014/05/">May 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/08/">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/02/">February 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/01/">January 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2012/12/">December 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2012/11/">November 2012</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/hexotech/2016/12/23/enable-https-and-tokenless-auth-for-keystone/">Enable https and tokenless auth for keystone</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/12/23/setup-your-own-ca/">Setup your own CA</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/10/11/atom-tips/">atom tips</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/10/11/vagrant-multiple-vms/">vagrant multiple vms</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/09/23/install-ceph-through-vagrant-on-centos7/">install ceph through vagrant on centos7</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Andrew Liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/hexotech/" class="mobile-nav-link">Home</a>
  
    <a href="/hexotech/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'andrewliu117';
  
  var disqus_url = 'http://liuhongjiang.github.io/hexotech/2015/08/25/install-spark/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/hexotech/js/jquery-2.1.4.min.js" type="text/javascript"></script>

<!--<script type="text/x-mathjax-config">-->
<!--MathJax.Hub.Config({-->
  <!--tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}-->
<!--});-->
<!--</script>-->
<!--<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">-->
<!--</script>-->


  <link rel="stylesheet" href="/hexotech/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/hexotech/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/hexotech/js/script.js" type="text/javascript"></script>



  </div>
</body>
</html>