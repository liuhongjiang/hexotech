<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>设置ftp匿名下载的服务 | Andrew&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="经常要在服务器上设置一些匿名账号，方便CI build处理啊的包，其他人可以下载，所以简单写了一个如果设置匿名ftp的文章，免得每次都要去网上找。">
<meta property="og:type" content="article">
<meta property="og:title" content="设置ftp匿名下载的服务">
<meta property="og:url" content="http://liuhongjiang.github.io/2015/10/14/install-ftp/index.html">
<meta property="og:site_name" content="Andrew's Blog">
<meta property="og:description" content="经常要在服务器上设置一些匿名账号，方便CI build处理啊的包，其他人可以下载，所以简单写了一个如果设置匿名ftp的文章，免得每次都要去网上找。">
<meta property="og:updated_time" content="2016-10-27T08:34:36.641Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="设置ftp匿名下载的服务">
<meta name="twitter:description" content="经常要在服务器上设置一些匿名账号，方便CI build处理啊的包，其他人可以下载，所以简单写了一个如果设置匿名ftp的文章，免得每次都要去网上找。">
  
    <link rel="alternative" href="/atom.xml" title="Andrew&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/hexotech/images/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/hexotech/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/hexotech/" id="logo">Andrew&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/hexotech/">Home</a>
        
          <a class="main-nav-link" href="/hexotech/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://liuhongjiang.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-install-ftp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/hexotech/2015/10/14/install-ftp/" class="article-date">
  <time datetime="2015-10-14T09:12:25.000Z" itemprop="datePublished">2015-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/hexotech/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      设置ftp匿名下载的服务
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>经常要在服务器上设置一些匿名账号，方便CI build处理啊的包，其他人可以下载，所以简单写了一个如果设置匿名ftp的文章，免得每次都要去网上找。</p>
<a id="more"></a>
<p>安装ftp server</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum <span class="keyword">install</span> vsftpd</span><br></pre></td></tr></table></figure>
<p>修改配置文件<code>/etc/vsftpd/vsftpd.conf</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="keyword">vi</span> /etc/vsftpd/vsftpd.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure>
<p>打开运行匿名用户登陆：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="setting">anonymous_enable=<span class="value"><span class="keyword">YES</span></span></span></span><br></pre></td></tr></table></figure>
<p>配置匿名用户的根目录</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">anon_root=<span class="regexp">/home/some</span><span class="regexp">/path/</span></span><br></pre></td></tr></table></figure>
<p>需要注意的一点，就是这个路径的所有目录的权限都是755，对于其他用户可以读和可执行的。</p>
<p>关闭或者设置防火墙 <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service iptables <span class="built_in">stop</span><span class="comment"> // centos 6</span></span><br><span class="line"></span><br><span class="line">systemctl <span class="built_in">stop</span> firewalld  <span class="comment"> // centos 7</span></span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure></p>
<p>启动 <figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo service vsftpd restart     <span class="comment">// centos 6</span></span><br><span class="line"></span><br><span class="line">systemctl restart vsftpd        <span class="comment">// centos 7</span></span><br></pre></td></tr></table></figure></p>
<p>将vsftpd设置为启动时，自动运行 <figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig vsftpd <span class="function_start"><span class="keyword">on</span></span></span><br></pre></td></tr></table></figure></p>
<h2 id="问题">问题</h2>
<p>配置完成后，启动了ftp服务，但是通过浏览器，打开ftp，显示为空，没有任务内容。</p>
<p>使用ftp命令连接，显示下面这个错误</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VSFTPD: Transfer Done (but failed <span class="built_in">to</span> <span class="built_in">open</span> <span class="built_in">directory</span>)</span><br></pre></td></tr></table></figure>
<p>原因是selinux将这个连接视为可疑的，解决办法就是讲selinx disable，然后重启服务器。</p>
<h2 id="添加用户">添加用户</h2>
<p>请参考：</p>
<p>http://serverfault.com/questions/544850/create-new-vsftpd-user-and-lock-to-specify-home-login-directory</p>
<p>具体步骤：</p>
<ol style="list-style-type: decimal">
<li>Create user with <code>useradd [user_name]</code>.</li>
<li>Create user’s password with <code>passwd [user_name]</code>. (You’ll be prompted to specify the password).</li>
<li>Create FTP directory in <code>/var/ftp</code> and then bind to the <code>home</code> directory you wish to specify for this user with <code>mount --bind /var/www/vhosts/domain.com/ /var/ftp/custom_name/</code>.</li>
<li>Change user’s home directory with <code>usermod -d /var/ftp/custom_name/ user_name</code></li>
<li>In /etc/vsftpd/vsftpd.conf, ensure all all of the following are set: <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="setting">chroot_local_user=<span class="value"><span class="keyword">YES</span></span></span></span><br><span class="line"><span class="setting">chroot_list_enable=<span class="value"><span class="keyword">YES</span></span></span></span><br><span class="line"><span class="setting">chroot_list_file=<span class="value">/etc/vsftpd.chroot_list</span></span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>Only list users in the vsftpd.chroot_list file if you want them to have full access to anywhere on the server. By not listing them in this file, you’re saying restrict all vsftpd users to their specified home directory.</p>
<p>需要注意的是，为user设置的home directory，需要设置full access。</p>
<h2 id="reference">reference</h2>
<p><a href="http://linuxconfig.org/how-to-stop-start-and-disable-enable-firewall-on-redhat-7-linux-system" target="_blank" rel="external">How to stop/start and disable/enable Firewall on Redhat 7 Linux system</a></p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-vsftpd-on-centos-6--2" target="_blank" rel="external">How To Set Up vsftpd on CentOS 6</a></p>
<p><a href="http://blog.danielburrowes.com/2009/06/vsftpd-transfer-done-but-failed-to-open.html" target="_blank" rel="external">VSFTPD: Transfer Done (but failed to open directory)</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://liuhongjiang.github.io/hexotech/2015/10/14/install-ftp/" data-id="cixb80co9000uf0i46xebazvg" class="article-share-link">Share</a>
      
        <a href="http://liuhongjiang.github.io/hexotech/2015/10/14/install-ftp/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/hexotech/2015/10/14/alembic-support-multiple-model-files/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          alembic support multiple model files
        
      </div>
    </a>
  
  
    <a href="/hexotech/2015/09/30/vpn-server/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">vpn server 搭建</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/3rd-nbsp-tools/">3rd&nbsp;tools</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Algorithm/">Algorithm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/C-C/">C/C++</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Data-nbsp-structure/">Data&nbsp;structure</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Fuck-nbsp-GFW/">Fuck&nbsp;GFW</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Language/">Language</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Machine-nbsp-Learning/">Machine&nbsp;Learning</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/Vi/">Vi</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/git/">git</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/hadoop/">hadoop</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/javascript/">javascript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/jenkins/">jenkins</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/keystone-openstack/">keystone, openstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/math/">math</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/octopress/">octopress</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/openssl/">openssl</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/openstack/">openstack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/paper/">paper</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/python/">python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/hexotech/categories/sqlite/">sqlite</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/12/">December 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/10/">October 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/05/">May 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/12/">December 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/11/">November 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/09/">September 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/08/">August 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/06/">June 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/05/">May 2015</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2015/04/">April 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2014/05/">May 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/11/">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/08/">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/02/">February 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2013/01/">January 2013</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2012/12/">December 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/hexotech/archives/2012/11/">November 2012</a><span class="archive-list-count">7</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/hexotech/2016/12/23/enable-https-and-tokenless-auth-for-keystone/">Enable https and tokenless auth for keystone</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/12/23/setup-your-own-ca/">Setup your own CA</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/10/11/atom-tips/">atom tips</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/10/11/vagrant-multiple-vms/">vagrant multiple vms</a>
          </li>
        
          <li>
            <a href="/hexotech/2016/09/23/install-ceph-through-vagrant-on-centos7/">install ceph through vagrant on centos7</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Andrew Liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/hexotech/" class="mobile-nav-link">Home</a>
  
    <a href="/hexotech/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'andrewliu117';
  
  var disqus_url = 'http://liuhongjiang.github.io/hexotech/2015/10/14/install-ftp/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="/hexotech/js/jquery-2.1.4.min.js" type="text/javascript"></script>

<!--<script type="text/x-mathjax-config">-->
<!--MathJax.Hub.Config({-->
  <!--tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}-->
<!--});-->
<!--</script>-->
<!--<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">-->
<!--</script>-->


  <link rel="stylesheet" href="/hexotech/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/hexotech/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/hexotech/js/script.js" type="text/javascript"></script>



  </div>
</body>
</html>